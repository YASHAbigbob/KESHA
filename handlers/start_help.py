from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import ContextTypes
from utils.logger import logger


def get_main_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏"""
    keyboard = [
        [KeyboardButton("/help"), KeyboardButton("/—Å—á–µ—Ç–∞")],
        [KeyboardButton("/—Å–≤–µ—Ä—å"), KeyboardButton("/–¥–∞–π")]
    ]
    return ReplyKeyboardMarkup(keyboard, resize_keyboard=True)


async def start_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    user = update.effective_user
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} ({user.full_name}) –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞")

    welcome_text = """
ü§ñ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –±–æ—Ç–∞-–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ –ö–µ—à—É!

–Ø –ø–æ–º–æ–≥—É –≤–∞–º –≤–µ—Å—Ç–∏ —É—á–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º —Å—á–µ—Ç–∞–º.

üìã –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
/start - –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É
/help - –ø–æ–º–æ—â—å
/–¥–æ–±–∞–≤—å - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á–µ—Ç
/—É–¥–∞–ª–∏ - —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç  
/—Å—á–µ—Ç–∞ - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å—á–µ—Ç–∞
/–¥–∞–π - –ø–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å—ã
/—Å–≤–µ—Ä—å - –∞—Ä—Ö–∏–≤–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏

üí° –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã:
–ö–µ—à–∞, —Å–≤–µ—Ä–µ–Ω–æ - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é
—Å–≤–µ—Ä–µ–Ω–æ - —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
/–¥–æ–±–∞–≤—å —Ä—É–±
/—Ä—É–± 100+50*2 –ó–∞—Ä–ø–ª–∞—Ç–∞
/–¥–∞–π —Ä—É–±
/—Å–≤–µ—Ä—å —Ä—É–±

‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ù–∞–∑–≤–∞–Ω–∏—è —Å—á–µ—Ç–æ–≤ –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–æ–∂–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∞—Ä—Ö–∏–≤–∞—Ü–∏–µ–π

–£–¥–∞—á–∏ –≤ —É—á–µ—Ç–µ! üìä
    """

    await update.message.reply_text(
        welcome_text,
        reply_markup=get_main_keyboard()
    )


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    user = update.effective_user
    logger.info(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} –∑–∞–ø—Ä–æ—Å–∏–ª –ø–æ–º–æ—â—å")

    help_text = """
üìã **–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:**

üí° **–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º –≤–≤–µ–¥–∏—Ç–µ /** 

üíº **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏:**
/–¥–æ–±–∞–≤—å [–Ω–∞–∑–≤–∞–Ω–∏–µ] - —Å–æ–∑–¥–∞—Ç—å —Å—á–µ—Ç (–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤)
/—É–¥–∞–ª–∏ [–Ω–∞–∑–≤–∞–Ω–∏–µ] - —É–¥–∞–ª–∏—Ç—å —Å—á–µ—Ç
/—Å—á–µ—Ç–∞ - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—á–µ—Ç–æ–≤

üí≥ **–û–ø–µ—Ä–∞—Ü–∏–∏:**
/[—Å—á–µ—Ç] [—Å—É–º–º–∞] [–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π] - –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
–ü—Ä–∏–º–µ—Ä: /—Ä—É–± 100+50*2 –ó–∞—Ä–ø–ª–∞—Ç–∞
–ü—Ä–∏–º–µ—Ä: /–±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞ 1500 –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

üìä **–ü—Ä–æ—Å–º–æ—Ç—Ä:**
/–¥–∞–π - –±–∞–ª–∞–Ω—Å—ã –ø–æ –≤—Å–µ–º —Å—á–µ—Ç–∞–º
/–¥–∞–π [—Å—á–µ—Ç] - –≤—ã–ø–∏—Å–∫–∞ –ø–æ —Å—á–µ—Ç—É

üîÑ **–°–≤–µ—Ä–∫–∞:**
/—Å–≤–µ—Ä—å - –≤—ã–±–æ—Ä —Å—á–µ—Ç–∞ –¥–ª—è —Å–≤–µ—Ä–∫–∏
/—Å–≤–µ—Ä—å [—Å—á–µ—Ç] - —Å–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—á–µ—Ç–∞

‚ö° **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
1. /–¥–æ–±–∞–≤—å —Ä—É–±
2. /—Ä—É–± 100+50*2 –ü–µ—Ä–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
3. /–¥–∞–π
4. /—Å–≤–µ—Ä—å —Ä—É–± - –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é

   """

    await update.message.reply_text(
        help_text,
        reply_markup=get_main_keyboard()
    )


async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫"""
    logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ update {update}: {context.error}")

    if update and update.effective_message:
        await update.effective_message.reply_text(
            "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.",
            reply_markup=get_main_keyboard()
        )